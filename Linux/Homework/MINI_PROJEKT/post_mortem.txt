################# POST MORTEN #######################

РАЗДЕЛ №1. КРАТКОЕ ОПИСАНИЕ
Сервер с которым возникла проблема: http://3.73.44.38
Первичная проблема: Отсутствие доступа к сайту
Время обнаружение первичной проблемы: 2024-10-28 09:00
Время исправления проблем: 2024-10-28 9:38
Сотрудник обнаруживший проблему: Мутаф Владимир
Сотрудник которому было поручено исправить проблему: Мутаф Владимир
Куратор: Чумак Иван

Выявленные проблемы:
1. Файл /var/www/html/mediawiki/LocalSettings.php был пуст
2. Полностью заполнено дисковое пространство из-за файла access_log.
3. Наличие в планировщике cron команды архивации (tar) которая отрабатывала ежесекундно и была некорректной
3. Наличие в резервной копии файла LocalSettings.php некорректной ссылки на сервер


РАЗДЕЛ №1. ПОДРОБНОЕ ОПИСАНИЕ

2024-10-28 09:00
Прибыв на рабочее место обнаружено проблему: отсутствие доступа к сайту http://3.73.44.38

2024-10-28 09:01
Созвон с непосредственным руководителем Чумаком Иваном, в котором я описал проблему.
От Чумака Ивана поставлена задача в крадчайшее время, при использовании любых средств восстановить работу сайта

2024-10-28 09:02
Предпринята попытка входа на сервер [1].
Результат: успешно

2024-10-28 09:02
Просмотр статуса процесса httpd [2].
Результат: active (running)

2024-10-28 09:03
Проверка файла с настройками приложения LocalSettings.php [3].
Результат: файл пуст

2024-10-28 09:03 - 9:05
Созвон с Сисадмином - Негодяйченко Алексеем.
Результат: Получена информация о наличии резервной копии этого файла

2024-10-28 09:03 - 9:06
Попытка чтения резервной копии файла с настройками приложения LocalSettings_reserv.php [4].
Результат: Невозможность выполнения команды из-за отсутствия места на жестком диске сервера.

2024-10-28 09:03 - 9:06
Проверка наличия места на жестком диске сервера [5].
Результат: Место на жестком диске полностью заполнено
/dev/nvme0n1p1 10G   10G     0 100% /

2024-10-28 09:03 - 9:07
Поиск самых тяжеловесных файлов [6]
Результат: Огромный вывод директорий с ограничением доступа

2024-10-28 09:03 - 9:07
Ввиду ограниченности времени на решение поставленных задач, принято решение использовать команду sudo [7].
Результат: Найден файл занимающий 70% дискового пространства
7.0G /var/log/httpd/access_log

2024-10-28 09:03 - 9:07 - 9:08
Созвон с непосредственным руководителем Чумаком Иваном.
Результат: поставлена задача сохранить файл access_log

2024-10-28 09:08 - 9:15
Скачивание файла на свой рабочий компьютер [8].
Результат: успешно

2024-10-28 9:16
Удаление содержимого файла /var/log/httpd/access_log [9]
Результат: успешно

2024-10-28 09:03 - 9:06
Проверка наличия места на жестком диске сервера [5].
Результат: Свободно 70%

2024-10-28 9:17
Повторная попытка чтения резервной копи с настройками приложения LocalSettings_reserv.php [4].
Результат: Файл содержит настройки приложения

2024-10-28 9:18
Восстановление содержимого файла LocalSettings.php [10].
Результат: Отказано в доступе к файлу

2024-10-28 9:19
Просмотр прав на файлы LocalSettings.php и LocalSettings_reserv.php [11][12].

2024-10-28 9:20
Повторная попытка восстановление содержимого файла LocalSettings.php с использованием команды sudo [13].
Результат: Отказано в доступе к файлу

2024-10-28 9:20
Проверка возможностей команды sudo [14].

2024-10-28 9:21
Открытие новой оболочки с правами root [15].
Результат: успешно

2024-10-28 9:21
Попытка восстановление содержимого файла LocalSettings.php в режиме суперпользователя [10].
Результат: успешно

2024-10-28 9:22
Проверка доступа к сайту http://3.73.44.38
Результат: неуспешно

2024-10-28 9:22 - 9:24
Поиск проблемы [3].
Результат: Обнаружено ошибку. В переменной $wgServer
которая содержится в файле LocalSettings.php указан неверный адрес "https://18.153.51.162"

2024-10-28 9:22 - 9:25
Устранение ошибки пути переменной $wgServer в файле LocalSettings.php [16].
Результат: успешно

2024-10-28 9:26
Проверка восстановления работы доступа к сайту http://3.73.44.38
Результат: успешно

2024-10-28 9:27
Проверка наличия места на жестком диске сервера [5].
Результат: Свободно 60%
Обнаружена проблема быстрой заполняймойсти ресурсов сервера.

2024-10-28 9:28
Проверка планировщика cron [17].
Результат: обнаружена некорректная задача по архивированию логов
 * * * * * tar -czf /var/log/httpd/log_$(date +\%Y\%m\%d).tar.gz -C /var/log/httpd

2024-10-28 9:29
Остановка некорректной задачи в cron [18].
Результат: успешно
# * * * * * tar -czf /var/log/httpd/log_$(date +\%Y\%m\%d).tar.gz -C /var/log/httpd

2024-10-28 9:30 - 9:36
Создание скрипта для архивирования файла access_log [19][20][21][22].
Результат: успешно

2024-10-28 9:37
Установка корректной задачи в cron с отработкой 1 раз в 24 часа [18].
Результат: успешно
0 0 * * * /home/ec2-user/backup_logs.sh

2024-10-28 9:38
Выход из режима суперпользователя [23].
Результат: успешно

2024-10-28 9:39
Созвон с непосредственным руководителем Чумаком Иваном с устным отчетом об успехе.


РАЗДЕЛ 3. Итоговый результат

1. Доступ к сайту http://3.73.44.38 востановлен 2024-10-28 9:26
2. Содержимое файла access_log сохранено
3. Установлена корректная задача в cron по архивации логов


РАЗДЕЛ 4. Использованные команды

1. ssh -i ich.pem ec2-user@3.73.44.38
2. service httpd status
3. cat /var/www/html/mediawiki/LocalSettings.php
4. cat /reserv_files/LocalSettings_reserv.php
5. df -h
6. find / -type f -size +100M -exec du -h {} +
7. sudo find / -type f -size +100M -exec du -h {} +
8. scp -i ich.pem ec2-user@3.73.44.38:/var/log/httpd/access_log  /reserv_file
9. echo "" >  /var/log/httpd/access_log
10. cp /reserv_files/LocalSettings_reserv.php  /var/www/html/mediawiki/LocalSettings.php
11. ls -l /reserv_files/LocalSettings_reserv.php
12. ls -l /var/www/html/mediawiki/LocalSettings.php
13. sudo cp /reserv_files/LocalSettings_reserv.php  /var/www/html/mediawiki/LocalSettings.php
14. sudo -l
15. sudo su
16. vi /var/www/html/mediawiki/LocalSettings.php
17. crontab -l
18. crontab -e
19. сd /home/ec2-user/
20. > backup_logs.sh
21. chmod 744 backup_logs.sh
22. vi 744 backup_logs.sh
23. exit


РАЗДЕЛ 4. Предложения по улучшению работы сервера

1. Сервер не имеет системы оповещения о критической ситуации с заполнением хранилища


2.

https://github.com/Mutaf-Volodymyr/My_education/blob/main/Linux/Homework/HW_17/script_ping.sh





